//Copyright (c) 2015 Eric Vallee <eric_vallee2003@yahoo.ca>
//MIT License: https://raw.githubusercontent.com/Magnitus-/ExpressAccessControl/master/License.txt

function Authenticate(Req, Groups, Or)
{
    var IsOr = Or ? Or : true;
    if(Req.session&&Req.session.User)
    {
        if(Groups)
        {
            var Operator = Or ? 'some' : 'every';
            return(Groups[Operator](function(Group, GroupIndex, GroupList) {
                return(Req.session.User.Memberships.some(function(Membership, MembershipIndex, MembershipList) {
                    return(Membership==Group); 
                }));
            }));
        }
        else
        {
            return(true);
        }
    }
    
    return(false);
}

function AuthenticateRoute(Groups, Or)
{
    return(function(Req, Res, Next) {
        if(Authenticate(Req, Groups, Or))
        {
            Next();
        }
        else
        {
            Res.status(401).end();
        }
    });
}

module.exports = {'Authenticate': Authenticate, 'AthenticateRoute': AuthenticateRoute}
